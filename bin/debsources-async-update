#!/usr/bin/env python

# Copyright (C) 2015  The Debsources developers <info@sources.debian.net>.
# See the AUTHORS file at the top-level directory of this distribution and at
# https://anonscm.debian.org/gitweb/?p=qa/debsources.git;a=blob;f=AUTHORS;hb=HEAD
#
# This file is part of Debsources. Debsources is free software: you can
# redistribute it and/or modify it under the terms of the GNU Affero General
# Public License as published by the Free Software Foundation, either version 3
# of the License, or (at your option) any later version.  For more information
# see the COPYING file at the top-level directory of this distribution and at
# https://anonscm.debian.org/gitweb/?p=qa/debsources.git;a=blob;f=COPYING;hb=HEAD

from __future__ import absolute_import

import argparse
import logging

from debsources import mainlib
from debsources.new_updater.update import do_update


if __name__ == '__main__':
    cmdline = argparse.ArgumentParser(description='Debsources updater')
    mainlib.add_arguments(cmdline)
    args = cmdline.parse_args()

    conf = mainlib.load_conf(args.conffile or mainlib.guess_conffile())
    mainlib.override_conf(conf, args)
    mainlib.init_logging(conf, mainlib.log_level_of_verbosity(args.verbose))
    logging.debug('loaded configuration from %s' % conf['conffile'])
    conf['observers'], conf['file_exts'] = mainlib.load_hooks(conf)
    mainlib.conf_warnings(conf)

    print(conf)


    print("Running updater...")
    do_update(conf)
